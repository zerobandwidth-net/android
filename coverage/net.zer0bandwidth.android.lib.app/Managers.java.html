<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Managers.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">net.zer0bandwidth.android.lib.app</a> &gt; <span class="el_source">Managers.java</span></div><h1>Managers.java</h1><pre class="source lang-java linenums">package net.zer0bandwidth.android.lib.app;

import android.accounts.AccountManager;
import android.annotation.SuppressLint;
import android.app.ActivityManager;
import android.app.AlarmManager;
import android.app.AppOpsManager;
import android.app.DownloadManager;
import android.app.KeyguardManager;
import android.app.NotificationManager;
import android.app.SearchManager;
import android.app.UiModeManager;
import android.app.WallpaperManager;
import android.app.admin.DevicePolicyManager;
import android.app.job.JobScheduler;
import android.app.usage.UsageStatsManager;
import android.appwidget.AppWidgetManager;
import android.bluetooth.BluetoothManager;
import android.content.ClipboardManager;
import android.content.Context;
import android.content.RestrictionsManager;
import android.content.pm.LauncherApps;
import android.hardware.ConsumerIrManager;
import android.hardware.SensorManager;
import android.hardware.camera2.CameraManager;
import android.hardware.display.DisplayManager;
import android.hardware.input.InputManager;
import android.hardware.usb.UsbManager;
import android.location.LocationManager;
import android.media.AudioManager;
import android.media.MediaRouter;
import android.media.projection.MediaProjectionManager;
import android.media.session.MediaSessionManager;
import android.media.tv.TvInputManager;
import android.net.ConnectivityManager;
import android.net.nsd.NsdManager;
import android.net.wifi.WifiManager;
import android.net.wifi.p2p.WifiP2pManager;
import android.nfc.NfcManager;
import android.os.BatteryManager;
import android.os.Build;
import android.os.DropBoxManager;
import android.os.PowerManager;
import android.os.UserManager;
import android.os.Vibrator;
import android.os.storage.StorageManager;
import android.print.PrintManager;
import android.telecom.TelecomManager;
import android.telephony.SubscriptionManager;
import android.telephony.TelephonyManager;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.WindowManager;
import android.view.accessibility.AccessibilityManager;
import android.view.accessibility.CaptioningManager;
import android.view.inputmethod.InputMethodManager;
import android.view.textservice.TextServicesManager;

import java.util.HashMap;

/**
 * Provides instances of Android OS managers.
 *
 * This class is largely irrelevant after Android API 23, which adds the new
 * {@code getSystemService(Class)} method to the {@link Context} class.
 * System service classes added after Android API 23 are not supported by this
 * class; if you are using a system service added after API 23, then you should
 * consider this class deprecated and use the new method in {@code Context}
 * instead.
 *
 * For backward compatibility from Android API 14 onward, the class provides
 * constant values for all static manager tags that were added to
 * {@code Context} after API 14.
 *
 * @since zer0bandwidth-net/android 0.1.3 (#29)
 */
<span class="nc" id="L77">public class Managers</span>
{
<span class="fc" id="L79">	protected static final String LOG_TAG = Managers.class.getSimpleName() ;</span>

/// Android API 16 Constants ///////////////////////////////////////////////////

	/**
	 * Backward-compatibility constant for {@code Context.INPUT_SERVICE}
	 * (added in Android API 16)
	 */
	public static final String INPUT_SERVICE = &quot;input&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.MEDIA_ROUTER_SERVICE}
	 * (added in Android API 16)
	 */
	public static final String MEDIA_ROUTER_SERVICE = &quot;media_router&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.NSD_SERVICE}
	 * (added in Android API 16)
	 */
	public static final String NSD_SERVICE = &quot;servicediscovery&quot; ;

/// Android API 17 Constants ///////////////////////////////////////////////////

	/**
	 * Backward-compatibility constant for {@code Context.DISPLAY_SERVICE}
	 * (added in Android API 17)
	 */
	public static final String DISPLAY_SERVICE = &quot;display&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.USER_SERVICE}
	 * (added in Android API 17)
	 */
	public static final String USER_SERVICE = &quot;user&quot; ;

/// Android API 18 Constants ///////////////////////////////////////////////////

	/**
	 * Backward-compatibility constant for {@code Context.BLUETOOTH_SERVICE}
	 * (added in Android API 18)
	 */
	public static final String BLUETOOTH_SERVICE = &quot;bluetooth&quot; ;

/// Android API 19 Constants ///////////////////////////////////////////////////

	/**
	 * Backward-compatibility constant for {@code Context.APP_OPS_SERVICE}
	 * (added in Android API 19)
	 */
	public static final String APP_OPS_SERVICE = &quot;appops&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.CAPTIONING_SERVICE}
	 * (added in Android API 19)
	 */
	public static final String CAPTIONING_SERVICE = &quot;captioning&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.CONSUMER_IR_SERVICE}
	 * (added in Android API 19)
	 */
	public static final String CONSUMER_IR_SERVICE = &quot;consumer_ir&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.PRINT_SERVICE}
	 * (added in Android API 19)
	 */
	public static final String PRINT_SERVICE = &quot;print&quot; ;

/// Android API 21 Constants ///////////////////////////////////////////////////

	/**
	 * Backward-compatibility constant for {@code Context.APPWIDGET_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String APPWIDGET_SERVICE = &quot;appwidget&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.BATTERY_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String BATTERY_SERVICE = &quot;batterymanager&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.CAMERA_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String CAMERA_SERVICE = &quot;camera&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.JOB_SCHEDULER_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String JOB_SCHEDULER_SERVICE = &quot;taskmanager&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.LAUNCHER_APPS_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String LAUNCHER_APPS_SERVICE = &quot;launcherapps&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.MEDIA_PROJECTION_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String MEDIA_PROJECTION_SERVICE = &quot;media_projection&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.MEDIA_SESSION_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String MEDIA_SESSION_SERVICE = &quot;media_session&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.RESTRICTIONS_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String RESTRICTIONS_SERVICE = &quot;restrictions&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.TELECOM_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String TELECOM_SERVICE = &quot;telecom&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.TV_INPUT_SERVICE}
	 * (added in Android API 21)
	 */
	public static final String TV_INPUT_SERVICE = &quot;tv_input&quot; ;

/// Android API 22 Constants ///////////////////////////////////////////////////

	/**
	 * Backward-compatibility constant for {@code Context.TELECOM_SUBSCRIPTION_SERVICE}
	 * (added in Android API 22)
	 */
	public static final String TELEPHONY_SUBSCRIPTION_SERVICE =
				&quot;telephony_subscription_service&quot; ;

	/**
	 * Backward-compatibility constant for {@code Context.USAGE_STATS_SERVICE}
	 * (added in Android API 22)
	 */
	public static final String USAGE_STATS_SERVICE = &quot;usagestats&quot; ;

/// And now, the interesting bits //////////////////////////////////////////////

	/**
	 * Defines a reverse mapping from class definitions to the constants by
	 * which they are identified in {@link Context}. Where those constants are
	 * not defined until later API versions, the map instead uses one of the
	 * compatibility constants defined in this class.
	 *
	 * &lt;h3&gt;Documentation Conflicts&lt;/h3&gt;
	 *
	 * The following errors in the Android API documentation for {@code Context}
	 * were observed during unit testing.
	 *
	 * &lt;table&gt;
	 *     &lt;thead&gt;
	 *         &lt;tr&gt;
	 *             &lt;th&gt;Context Token&lt;/th&gt;
	 *             &lt;th&gt;Documented Class&lt;/th&gt;
	 *             &lt;th&gt;Actual Class&lt;/th&gt;
	 *             &lt;th&gt;Resolution&lt;/th&gt;
	 *         &lt;/tr&gt;
	 *     &lt;/thead&gt;
	 *     &lt;tbody&gt;
	 *         &lt;tr&gt;
	 *             &lt;td&gt;{@link Context#SENSOR_SERVICE}&lt;/td&gt;
	 *             &lt;td&gt;{@link SensorManager}&lt;/td&gt;
	 *             &lt;td&gt;{@code android.hardware.SystemSensorManager}&lt;/td&gt;
	 *             &lt;td&gt;The actual class is assignable.&lt;/td&gt;
	 *         &lt;/tr&gt;
	 *         &lt;tr&gt;
	 *             &lt;td&gt;{@link Context#WALLPAPER_SERVICE}&lt;/td&gt;
	 *             &lt;td&gt;{@link android.service.wallpaper.WallpaperService}&lt;/td&gt;
	 *             &lt;td&gt;{@link WallpaperManager}&lt;/td&gt;
	 *             &lt;td&gt;
	 *                 The returned class is not assignable; the map uses
	 *                 {@code WallpaperManager} &lt;b&gt;instead of&lt;/b&gt;
	 *                 {@code WallpaperService}.
	 *             &lt;/td&gt;
	 *         &lt;/tr&gt;
	 *     &lt;/tbody&gt;
	 * &lt;/table&gt;
	 *
	 * This map is instantiated only when the app's API version is lower than
	 * 23. When greater than 23, the {@link #get} method will simply call the
	 * existing {@code getSystemService(Class)} method in the API 23+ version of
	 * {@code Context}, so the map would not need to be populated.
	 *
	 * @see Context
	 */
	public static HashMap&lt;Class&lt;?&gt;,String&gt; REVERSE_MAP ;

	static // initializer for REVERSE_MAP; executes only if needed
	{
<span class="pc bpc" id="L279" title="1 of 2 branches missed.">		if( Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.M )</span>
<span class="nc" id="L280">			initReverseMap( Build.VERSION.SDK_INT ) ;</span>
<span class="fc" id="L281">	}</span>

	/**
	 * Initializes the reverse mapping of manager classes to constants from the
	 * {@link Context} class. Invoked by a static initializer for the class
	 * itself; the method is not intended to be called directly, except in unit
	 * testing scenarios.
	 * @param nVersion (since 0.2.1/#53) the environment's current SDK
	 *   version; passed in as a parameter solely to support testing. See how
	 *   this is used &quot;normally&quot; in the static initializer.
	 */
	@SuppressLint( &quot;NewApi&quot; )     // Build version managed via switch() control.
	protected static void initReverseMap( int nVersion )
	{
<span class="fc" id="L295">		REVERSE_MAP = new HashMap&lt;&gt;() ;</span>

<span class="fc" id="L297">		Log.d( LOG_TAG, (new StringBuilder())</span>
<span class="fc" id="L298">				.append( &quot;Loading reverse map for Android API &quot; )</span>
<span class="fc" id="L299">				.append( nVersion )</span>
<span class="fc" id="L300">				.toString()</span>
			);

<span class="pc bpc" id="L303" title="6 of 7 branches missed.">		switch( nVersion )</span>
		{ // Fall through cases in reverse, populating each API's new classes.
			case 22:
<span class="fc" id="L306">				REVERSE_MAP.put( SubscriptionManager.class, TELEPHONY_SUBSCRIPTION_SERVICE ) ;</span>
<span class="fc" id="L307">				REVERSE_MAP.put( UsageStatsManager.class, USAGE_STATS_SERVICE ) ;</span>
			case 21:
<span class="fc" id="L309">				REVERSE_MAP.put( AppWidgetManager.class, APPWIDGET_SERVICE ) ;</span>
<span class="fc" id="L310">				REVERSE_MAP.put( BatteryManager.class, BATTERY_SERVICE ) ;</span>
<span class="fc" id="L311">				REVERSE_MAP.put( CameraManager.class, CAMERA_SERVICE ) ;</span>
<span class="fc" id="L312">				REVERSE_MAP.put( JobScheduler.class, JOB_SCHEDULER_SERVICE ) ;</span>
<span class="fc" id="L313">				REVERSE_MAP.put( LauncherApps.class, LAUNCHER_APPS_SERVICE ) ;</span>
<span class="fc" id="L314">				REVERSE_MAP.put( MediaProjectionManager.class, MEDIA_PROJECTION_SERVICE ) ;</span>
<span class="fc" id="L315">				REVERSE_MAP.put( MediaSessionManager.class, MEDIA_SESSION_SERVICE ) ;</span>
<span class="fc" id="L316">				REVERSE_MAP.put( RestrictionsManager.class, RESTRICTIONS_SERVICE ) ;</span>
<span class="fc" id="L317">				REVERSE_MAP.put( TelecomManager.class, TELECOM_SERVICE ) ;</span>
<span class="fc" id="L318">				REVERSE_MAP.put( TvInputManager.class, TV_INPUT_SERVICE ) ;</span>
			case 20:
			case 19:
<span class="fc" id="L321">				REVERSE_MAP.put( AppOpsManager.class, APP_OPS_SERVICE ) ;</span>
<span class="fc" id="L322">				REVERSE_MAP.put( CaptioningManager.class, CAPTIONING_SERVICE ) ;</span>
<span class="fc" id="L323">				REVERSE_MAP.put( ConsumerIrManager.class, CONSUMER_IR_SERVICE ) ;</span>
<span class="fc" id="L324">				REVERSE_MAP.put( PrintManager.class, PRINT_SERVICE ) ;</span>
			case 18:
<span class="fc" id="L326">				REVERSE_MAP.put( BluetoothManager.class, BLUETOOTH_SERVICE ) ;</span>
			case 17:
<span class="fc" id="L328">				REVERSE_MAP.put( DisplayManager.class, DISPLAY_SERVICE ) ;</span>
<span class="fc" id="L329">				REVERSE_MAP.put( UserManager.class, USER_SERVICE ) ;</span>
			case 16:
<span class="fc" id="L331">				REVERSE_MAP.put( InputManager.class, INPUT_SERVICE );</span>
<span class="fc" id="L332">				REVERSE_MAP.put( MediaRouter.class, MEDIA_ROUTER_SERVICE );</span>
<span class="fc" id="L333">				REVERSE_MAP.put( NsdManager.class, NSD_SERVICE );</span>
			default: // No new managers in API 15; library minimum is 14.
<span class="fc" id="L335">				REVERSE_MAP.put( AccessibilityManager.class, Context.ACCESSIBILITY_SERVICE ) ;</span>
<span class="fc" id="L336">				REVERSE_MAP.put( AccountManager.class, Context.ACCOUNT_SERVICE ) ;</span>
<span class="fc" id="L337">				REVERSE_MAP.put( ActivityManager.class, Context.ACTIVITY_SERVICE ) ;</span>
<span class="fc" id="L338">				REVERSE_MAP.put( AlarmManager.class, Context.ALARM_SERVICE ) ;</span>
<span class="fc" id="L339">				REVERSE_MAP.put( AudioManager.class, Context.AUDIO_SERVICE ) ;</span>
<span class="fc" id="L340">				REVERSE_MAP.put( ClipboardManager.class, Context.CLIPBOARD_SERVICE ) ;</span>
<span class="fc" id="L341">				REVERSE_MAP.put( ConnectivityManager.class, Context.CONNECTIVITY_SERVICE ) ;</span>
<span class="fc" id="L342">				REVERSE_MAP.put( DevicePolicyManager.class, Context.DEVICE_POLICY_SERVICE ) ;</span>
<span class="fc" id="L343">				REVERSE_MAP.put( DownloadManager.class, Context.DOWNLOAD_SERVICE ) ;</span>
<span class="fc" id="L344">				REVERSE_MAP.put( DropBoxManager.class, Context.DROPBOX_SERVICE ) ;</span>
<span class="fc" id="L345">				REVERSE_MAP.put( InputMethodManager.class, Context.INPUT_METHOD_SERVICE ) ;</span>
<span class="fc" id="L346">				REVERSE_MAP.put( KeyguardManager.class, Context.KEYGUARD_SERVICE ) ;</span>
<span class="fc" id="L347">				REVERSE_MAP.put( LayoutInflater.class, Context.LAYOUT_INFLATER_SERVICE ) ;</span>
<span class="fc" id="L348">				REVERSE_MAP.put( LocationManager.class, Context.LOCATION_SERVICE ) ;</span>
<span class="fc" id="L349">				REVERSE_MAP.put( NfcManager.class, Context.NFC_SERVICE ) ;</span>
<span class="fc" id="L350">				REVERSE_MAP.put( NotificationManager.class, Context.NOTIFICATION_SERVICE ) ;</span>
<span class="fc" id="L351">				REVERSE_MAP.put( PowerManager.class, Context.POWER_SERVICE ) ;</span>
<span class="fc" id="L352">				REVERSE_MAP.put( SearchManager.class, Context.SEARCH_SERVICE ) ;</span>
<span class="fc" id="L353">				REVERSE_MAP.put( SensorManager.class, Context.SENSOR_SERVICE ) ;</span>
<span class="fc" id="L354">				REVERSE_MAP.put( StorageManager.class, Context.STORAGE_SERVICE ) ;</span>
<span class="fc" id="L355">				REVERSE_MAP.put( TelephonyManager.class, Context.TELEPHONY_SERVICE ) ;</span>
<span class="fc" id="L356">				REVERSE_MAP.put( TextServicesManager.class, Context.TEXT_SERVICES_MANAGER_SERVICE ) ;</span>
<span class="fc" id="L357">				REVERSE_MAP.put( UiModeManager.class, Context.UI_MODE_SERVICE ) ;</span>
<span class="fc" id="L358">				REVERSE_MAP.put( UsbManager.class, Context.USB_SERVICE ) ;</span>
<span class="fc" id="L359">				REVERSE_MAP.put( Vibrator.class, Context.VIBRATOR_SERVICE ) ;</span>
<span class="fc" id="L360">				REVERSE_MAP.put( WallpaperManager.class, Context.WALLPAPER_SERVICE ) ;</span>
<span class="fc" id="L361">				REVERSE_MAP.put( WifiManager.class, Context.WIFI_SERVICE ) ;</span>
<span class="fc" id="L362">				REVERSE_MAP.put( WifiP2pManager.class, Context.WIFI_P2P_SERVICE ) ;</span>
<span class="fc" id="L363">				REVERSE_MAP.put( WindowManager.class, Context.WINDOW_SERVICE ) ;</span>
		}
<span class="fc" id="L365">	}</span>

	/**
	 * Obtains an instance of the Android OS service whose class is given.
	 *
	 * If the app's API version is already 23 or higher, then the method will
	 * simply call the new {@code getSystemService(Class)} method instead of
	 * executing its own compatibility logic.
	 *
	 * The return value of this method is already an instance of the type
	 * specified in the parameter; there is no need for additional typecasting
	 * after the instance is returned to the caller. This is exactly how the
	 * {@code getSystemService(Class)} method works in the API 23+ version of
	 * {@link Context}.
	 *
	 * @param ctx the context in which to obtain the service
	 * @param cls the class to be obtained, as a parameter
	 * @param &lt;MGR&gt; the class to be obtained, as a generic return type
	 * @return an instance of the specified class, or null if the system does
	 *  not return an instance
	 */
	@SuppressWarnings({ &quot;unchecked&quot;, &quot;WrongConstant&quot; })
	public static &lt;MGR&gt; MGR get( Context ctx, Class&lt;MGR&gt; cls )
	{
<span class="pc bpc" id="L389" title="1 of 2 branches missed.">		if( Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M )</span>
<span class="fc" id="L390">			return ctx.getSystemService( cls ) ;</span>

<span class="nc bnc" id="L392" title="All 2 branches missed.">		if( REVERSE_MAP.containsKey(cls) )</span>
<span class="nc" id="L393">			return ((MGR)( ctx.getSystemService( REVERSE_MAP.get(cls) ) )) ;</span>
		else
		{
<span class="nc" id="L396">			Log.w( LOG_TAG, (new StringBuilder())</span>
<span class="nc" id="L397">					.append( &quot;Cannot obtain instance of class [&quot; )</span>
<span class="nc" id="L398">					.append( cls.getCanonicalName() )</span>
<span class="nc" id="L399">					.append( &quot;] not found in the reverse map.&quot; )</span>
<span class="nc" id="L400">					.toString()</span>
				);
<span class="nc" id="L402">			return null ;</span>
		}
	}

	/**
	 * As {@link #get}, but executes the action inside a
	 * {@code try&amp;hellip;catch} structure, returning {@code null} if an
	 * exception is thrown
	 * @param ctx the context in which to obtain the service
	 * @param cls the class to be obtained, as a parameter
	 * @param &lt;MGR&gt; the class to be obtained, as a generic return type
	 * @return an instance of the specified class, or null if the system does
	 *  not return an instance, or null if an exception occurred
	 */
	public static &lt;MGR&gt; MGR tryToGet( Context ctx, Class&lt;MGR&gt; cls )
	{
<span class="nc" id="L418">		try { return get( ctx, cls ) ; }</span>
<span class="nc" id="L419">		catch( Exception x )</span>
		{
<span class="nc" id="L421">			Log.e( LOG_TAG, (new StringBuilder())</span>
<span class="nc" id="L422">					.append( &quot;Exception thrown while obtaining instance of &quot; )</span>
<span class="nc" id="L423">					.append( cls.getCanonicalName() )</span>
<span class="nc" id="L424">					.toString()</span>
				, x ) ;
<span class="nc" id="L426">			return null ;</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Generated by the Android Gradle plugin 3.1.3</div></body></html>