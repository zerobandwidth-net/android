<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MultitapAlertCompatDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">net.zer0bandwidth.android.lib.ui</a> &gt; <span class="el_source">MultitapAlertCompatDialog.java</span></div><h1>MultitapAlertCompatDialog.java</h1><pre class="source lang-java linenums">package net.zer0bandwidth.android.lib.ui;

import android.content.Context;
import android.support.v7.app.AlertDialog;
import android.content.DialogInterface;
import android.util.Log;
import android.view.View;
import android.widget.Button;

import net.zer0bandwidth.android.lib.app.AppUtils;
import net.zer0bandwidth.android.lib.R;

/**
 * Allows specification of a number of multiple taps before the positive button
 * takes action.
 *
 * Unlike the standard {@link AlertDialog}, this class is its own builder.
 *
 * Special thanks to &lt;code&gt;&lt;b&gt;@dapayne1&lt;/b&gt;&lt;/code&gt; for the original inspiration.
 *
 * This version of the dialog builds on the Android Compatibility Library. For
 * an extension of the modern {@code AlertDialog} class, see
 * {@link MultitapAlertDialog}.
 *
 * @since zer0bandwidth-net/android 0.0.2 (#8)
 */
@SuppressWarnings( &quot;unused&quot; )                              // This is a library.
public class MultitapAlertCompatDialog
extends AlertDialog
implements DialogInterface.OnClickListener
{
<span class="nc" id="L32">	public static final String LOG_TAG =</span>
<span class="nc" id="L33">			MultitapAlertCompatDialog.class.getSimpleName() ;</span>

	/**
	 * Specifies the default number of taps required on the positive button
	 * before its action is executed.
	 */
	public static final int DEFAULT_TAPS_REQUIRED = 5 ;

	/** The number of times that the positive button has been tapped so far. */
<span class="nc" id="L42">	protected int m_nTapsCurrent = 0 ;</span>

	/** The number of taps required to execute the positive button's action. */
<span class="nc" id="L45">	protected int m_nTapsRequired = DEFAULT_TAPS_REQUIRED ;</span>

	/**
	 * The resource ID of the string which formats the positive button's label.
	 * This defaults to a left-to-right format, but may be changed to a
	 * right-to-left format at runtime if the context demands it.
	 * @see R.string#label_btnMultitapPositive_LTR
	 * @see R.string#label_btnMultitapPositive_RTL
	 */
<span class="nc" id="L54">	protected int m_resPositiveLabelFormat =</span>
			R.string.label_btnMultitapPositive_LTR ;

	/**
	 * The positive button label. This will be used as the first part of the
	 * string format.
	 * @see #m_resPositiveLabelFormat
	 * @see R.string#label_btnMultitapPositive_LTR
	 * @see R.string#label_btnMultitapPositive_RTL
	 */
<span class="nc" id="L64">	protected String m_sPositiveLabel = null ;</span>

	/** The task to be executed if the positive button is tapped sufficiently. */
<span class="nc" id="L67">	protected Runnable m_taskPositive = null ;</span>

	/** The task to be executed if the negative button is tapped. */
<span class="nc" id="L70">	protected Runnable m_taskNegative = null ;</span>

	/**
	 * Once the dialog is constructed, this will hold a persistent reference to
	 * the positive button itself, so that we can dynamically update its text.
	 */
<span class="nc" id="L76">	protected Button m_btnPositive = null ;</span>

	/**
	 * Additional constructor allowing initial setup of title and message.
	 * @param ctx the context that will spawn the dialog
	 * @param resTitle the resource ID of the title string
	 * @param resMessage the resource ID of the message string
	 */
	public MultitapAlertCompatDialog( Context ctx, int resTitle, int resMessage )
	{
<span class="nc" id="L86">		super(ctx) ;</span>
<span class="nc" id="L87">		this.setTitle( resTitle ) ;</span>
<span class="nc" id="L88">		this.setMessage( ctx.getString( resMessage ) ) ;</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">		m_resPositiveLabelFormat = ( AppUtils.isTextCompatRTL(ctx) ?</span>
				R.string.label_btnMultitapPositive_RTL :
				R.string.label_btnMultitapPositive_LTR )
			;
<span class="nc" id="L93">	}</span>

	/**
	 * Sets the number of taps required to execute the positive action.
	 * @param nTaps the number of taps required
	 * @return (fluid)
	 */
	public MultitapAlertCompatDialog setPositiveTapsRequired( int nTaps )
<span class="nc" id="L101">	{ this.m_nTapsRequired = nTaps ; return this ; }</span>

	/**
	 * Add a positive button with the specified label, such that the specified
	 * task is executed when tapped the requisite number of times.
	 * @param resLabel the label for the button
	 * @param task the task to be executed
	 * @return (fluid)
	 */
	public MultitapAlertCompatDialog setPositiveButton( int resLabel, Runnable task )
	{
<span class="nc" id="L112">		final Context ctx = this.getContext() ;</span>
<span class="nc" id="L113">		m_taskPositive = task ;</span>
<span class="nc" id="L114">		m_sPositiveLabel = ctx.getString( resLabel ) ;</span>
<span class="nc" id="L115">		this.setButton( AlertDialog.BUTTON_POSITIVE, m_sPositiveLabel, this ) ;</span>
<span class="nc" id="L116">		return this ;</span>
	}

	/**
	 * Add a positive button which will execute the specified task when tapped
	 * the requisite number of times.
	 *
	 * The Android standard &quot;OK&quot; text ({@link android.R.string#ok}) will be used
	 * as the button label.
	 *
	 * @param task the task to be executed
	 * @return (fluid)
	 */
	public MultitapAlertCompatDialog setPositiveButton( Runnable task )
<span class="nc" id="L130">	{ return this.setPositiveButton( android.R.string.ok, task ) ; }</span>

	/**
	 * Add a negative button with the specified label, such that the specified
	 * task is executed when tapped &lt;i&gt;once&lt;/i&gt;.
	 * @param resLabel the label for the button
	 * @param task the task to be executed
	 * @return (fluid)
	 */
	public MultitapAlertCompatDialog setNegativeButton( int resLabel, Runnable task )
	{
<span class="nc" id="L141">		final Context ctx = this.getContext() ;</span>
<span class="nc" id="L142">		m_taskNegative = task ;</span>
<span class="nc" id="L143">		final String sNegativeLabel = ctx.getString( resLabel ) ;</span>
<span class="nc" id="L144">		this.setButton( AlertDialog.BUTTON_NEGATIVE, sNegativeLabel, this ) ;</span>
<span class="nc" id="L145">		return this ;</span>
	}

	/**
	 * Add a negative button which will execute the specified task when tapped
	 * &lt;i&gt;once&lt;/i&gt;.
	 *
	 * The Android standard &quot;Cancel&quot; ({@link android.R.string#cancel}) will be
	 * used as the button label.
	 *
	 * @param task the task to be executed
	 * @return (fluid)
	 */
	public MultitapAlertCompatDialog setNegativeButton( Runnable task )
<span class="nc" id="L159">	{ return this.setNegativeButton( android.R.string.cancel, task ) ; }</span>

	/**
	 * Sets up a standard &quot;OK&quot; positive button and a standard &quot;Cancel&quot; negative
	 * button, using the specified tasks.
	 * @param taskPositive the task to be executed if the positive button is
	 *                     tapped the requisite number of times
	 * @param taskNegative the task to be executed if the negative button is
	 *                     tapped &lt;i&gt;once&lt;/i&gt;
	 * @return (fluid)
	 */
	public MultitapAlertCompatDialog setStandardButtons( Runnable taskPositive, Runnable taskNegative )
	{
<span class="nc" id="L172">		return this.setPositiveButton( taskPositive )</span>
<span class="nc" id="L173">		           .setNegativeButton( taskNegative )</span>
				;
	}

	/**
	 * Regenerates the label of the positive button, showing the difference
	 * between the number of taps required and the number of taps already
	 * intercepted.
	 * @return the positive button label
	 */
	protected MultitapAlertCompatDialog regeneratePositiveLabel()
	{
<span class="nc" id="L185">		final int nTapsRemaining = m_nTapsRequired - m_nTapsCurrent ;</span>
<span class="nc" id="L186">		final String sLabel = this.getContext().getString(</span>
				m_resPositiveLabelFormat,
<span class="nc" id="L188">				m_sPositiveLabel, Integer.toString( nTapsRemaining )</span>
			);
<span class="nc" id="L190">		m_btnPositive.setText( sLabel ) ;</span>

<span class="nc" id="L192">		return this ;</span>
	}

	@Override
	public void onClick( DialogInterface dia, int zButtonID )
	{
<span class="nc bnc" id="L198" title="All 2 branches missed.">		switch( zButtonID )</span>
		{
			case AlertDialog.BUTTON_POSITIVE:
			{
<span class="nc" id="L202">				Log.d( LOG_TAG, &quot;Dismissing after positive press.&quot; ) ;</span>
<span class="nc" id="L203">				this.dismiss() ;</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">				if( m_taskPositive != null ) m_taskPositive.run() ;</span>
			} break ;
			case AlertDialog.BUTTON_NEGATIVE:
			default:
			{
<span class="nc" id="L209">				Log.d( LOG_TAG, (new StringBuilder())</span>
<span class="nc" id="L210">						.append( &quot;Clicked the negative button with &quot; )</span>
<span class="nc" id="L211">						.append( m_nTapsCurrent )</span>
<span class="nc" id="L212">						.append( &quot; prior taps.&quot; )</span>
<span class="nc" id="L213">						.toString()</span>
					);
<span class="nc" id="L215">				this.dismiss() ;</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">				if( m_taskNegative != null ) m_taskNegative.run() ;</span>
			}
		}
<span class="nc" id="L219">	}</span>

	@Override
	public void show()
	{
<span class="nc" id="L224">		super.show() ;</span>
<span class="nc" id="L225">		m_nTapsCurrent = 0 ; // Just in case a value weirdly persisted.</span>
<span class="nc" id="L226">		m_btnPositive = this.getButton( AlertDialog.BUTTON_POSITIVE ) ;</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">		if( m_btnPositive != null )</span>
		{ // Override the dialog's click listener with our own.
<span class="nc" id="L229">			this.regeneratePositiveLabel() ;</span>
<span class="nc" id="L230">			m_btnPositive.setOnClickListener( new Button.OnClickListener()</span>
<span class="nc" id="L231">			{</span>
<span class="nc" id="L232">				protected final MultitapAlertCompatDialog m_dia =</span>
						MultitapAlertCompatDialog.this ;

				@Override
				public void onClick( View w )
				{
<span class="nc bnc" id="L238" title="All 2 branches missed.">					if( ++(m_dia.m_nTapsCurrent) &gt;= m_dia.m_nTapsRequired )</span>
<span class="nc" id="L239">						m_dia.onClick( m_dia, AlertDialog.BUTTON_POSITIVE ) ;</span>
					else
<span class="nc" id="L241">						m_dia.regeneratePositiveLabel() ;</span>
<span class="nc" id="L242">				}</span>
			});
		}
<span class="nc" id="L245">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Generated by the Android Gradle plugin 3.1.3</div></body></html>