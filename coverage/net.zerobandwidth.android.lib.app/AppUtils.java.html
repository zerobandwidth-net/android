<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AppUtils.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">net.zerobandwidth.android.lib.app</a> &gt; <span class="el_source">AppUtils.java</span></div><h1>AppUtils.java</h1><pre class="source lang-java linenums">package net.zerobandwidth.android.lib.app;

import android.app.Activity;
import android.content.Context;
import android.content.pm.PackageInfo;
import android.content.res.Configuration;
import android.os.Build;
import android.support.v4.text.TextUtilsCompat;
import android.support.v4.view.ViewCompat;
import android.support.v7.app.AppCompatActivity;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;

import net.zerobandwidth.android.lib.R;

import java.util.Locale;

/**
 * Provides utilities for dealing with common Android app tasks.
 * @since zerobandwidth-net/android 0.0.1 (#5), moved in 0.0.4 (#13)
 */
@SuppressWarnings(&quot;unused&quot;) // This is a library.
<span class="nc" id="L24">public class AppUtils</span>
{
    /** A logging tag. */
<span class="nc" id="L27">    public static final String LOG_TAG = AppUtils.class.getSimpleName() ;</span>

    /**
     * Replacement text to be used if the app's version name can't be found.
     * @see #getAppVersion
     * @see #getAppNameAndVersion
     */
    public static final String APP_VERSION_NOT_FOUND = &quot;&quot; ;

    /**
     * Returns the string containing the app's current version.
     * @param ctx a context in which to fetch a package manager
     * @return the app version as a string, or an empty string if not found
     */
    public static String getAppVersion( Context ctx )
    {
        try
        {
<span class="nc" id="L45">            PackageInfo info = ctx.getPackageManager().getPackageInfo(</span>
<span class="nc" id="L46">                    ctx.getPackageName(), 0 ) ;</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">            return ( info.versionName == null ?</span>
                APP_VERSION_NOT_FOUND : info.versionName ) ;
        }
<span class="nc" id="L50">        catch( Exception x )</span>
        {
<span class="nc" id="L52">            Log.w( LOG_TAG, &quot;Can't discover app version.&quot; ) ;</span>
<span class="nc" id="L53">            return &quot;&quot; ;</span>
        }
    }

    /**
     * Returns a string containing the app's name and version (if found).
     * @param ctx a context in which to fetch resources
     * @return the app's name and version, formatted as specified by the default
     *  string resource
     * @see R.string#app_name_and_version_format
     */
    public static String getAppNameAndVersion( Context ctx )
    {
<span class="nc" id="L66">        return AppUtils.getAppNameAndVersion( ctx,</span>
                R.string.app_name_and_version_format ) ;
    }

    /**
     * Returns a string containing the app's name and version (if found).
     * @param ctx a context in which to fetch resources
     * @param resFormat a custom string resource specifying the format in which
     *                  the string should be rendered; must contain two string
     *                  variables (one for the name, one for the version)
     * @return the app's name and version, formatted as specified by the
     *  supplied string resource
     */
    public static String getAppNameAndVersion( Context ctx, int resFormat )
    {
<span class="nc" id="L81">        final String sAppName = ctx.getString( R.string.app_name ) ;</span>
<span class="nc" id="L82">        final String sAppVersion = AppUtils.getAppVersion(ctx) ;</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">        if( ! sAppVersion.equals( APP_VERSION_NOT_FOUND ) )</span>
<span class="nc" id="L84">            return ctx.getString( resFormat, sAppName, sAppVersion ) ;</span>
        else
<span class="nc" id="L86">            return sAppName ;</span>
    }

    /**
     * Initializes a back button for the activity.
     *
     * Call this method in your activity's {@link Activity#onCreate onCreate}
     * method. Then, in the activity's
     * {@link Activity#onOptionsItemSelected onOptionsItemSelected} method,
     * remember to set a handler for this button.
     *
     * &lt;pre&gt;
     *     public boolean onOptionsItemSelected( MenuItem item )
     *     {
     *         switch( item.getItemId() )
     *         {
     *             case android.R.id.home:
     *                 this.onBackPressed() ;
     *                 break ;
     *             // (other items...)
     *         }
     *     }
     * &lt;/pre&gt;
     *
     * @param act an activity.
     * @see &lt;a href=&quot;http://stackoverflow.com/a/33041114&quot;&gt;StackOverflow answer #33041114&lt;/a&gt;
     */
    @SuppressWarnings(&quot;ConstantConditions&quot;) // Exception is caught.
    public static void initBackButtonForActivity( Activity act )
    {
<span class="nc" id="L116">        try { act.getActionBar().setDisplayHomeAsUpEnabled(true) ; }</span>
<span class="nc" id="L117">        catch( Exception x )</span>
<span class="nc" id="L118">        { Log.d( LOG_TAG, &quot;Could not initialize back button.&quot;, x ) ; }</span>
<span class="nc" id="L119">    }</span>

    /**
     * Initializes a back button for the activity.
     *
     * Call this method in your activity's
     * {@link AppCompatActivity#onCreate onCreate} method. Then, in the activity's
     * {@link AppCompatActivity#onOptionsItemSelected onOptionsItemSelected}
     * method, remember to set a handler for this button.
     *
     * &lt;pre&gt;
     *     public boolean onOptionsItemSelected( MenuItem item )
     *     {
     *         switch( item.getItemId() )
     *         {
     *             case android.R.id.home:
     *                 this.onBackPressed() ;
     *                 break ;
     *             // (other items...)
     *         }
     *     }
     * &lt;/pre&gt;
     *
     * @param act an activity.
     * @see &lt;a href=&quot;http://stackoverflow.com/a/33041114&quot;&gt;StackOverflow answer #33041114&lt;/a&gt;
     */
    @SuppressWarnings(&quot;ConstantConditions&quot;) // Exception is caught.
    public static void initBackButtonForActivity( AppCompatActivity act )
    {
<span class="nc" id="L148">        try { act.getSupportActionBar().setDisplayHomeAsUpEnabled(true) ; }</span>
<span class="nc" id="L149">        catch( Exception x )</span>
<span class="nc" id="L150">        { Log.d( LOG_TAG, &quot;Could not initialize back button.&quot;, x ) ; }</span>
<span class="nc" id="L151">    }</span>

	/**
     * (in AppCompat context) Determines whether the current text layout is
     * right-to-left.
     * @param ctx the context in which to evaluate text directionality
     * @return {@code true} if text layout is right-to-left
     * @see TextUtilsCompat#getLayoutDirectionFromLocale
     * @see &lt;a href=&quot;http://stackoverflow.com/a/14389640&quot;&gt;Stack Overflow answer #14389640&lt;/a&gt;
     * @see &lt;a href=&quot;http://stackoverflow.com/a/23203698&quot;&gt;Stack Overflow answer #23203698&lt;/a&gt;
     * @since zerobandwidth-net/android 0.0.2 (#8)
     */
    public static boolean isTextCompatRTL( Context ctx )
    {
<span class="nc" id="L165">        Configuration cfg = ctx.getResources().getConfiguration() ;</span>

<span class="nc bnc" id="L167" title="All 2 branches missed.">        if( Build.VERSION.SDK_INT &lt; 17 )</span>
<span class="nc" id="L168">            return legacyIsTextRTL(cfg) ;</span>

        Locale loc ;
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if( Build.VERSION.SDK_INT &lt; 24 )</span>
        { // The `locale` property was deprecated in API 24.
            //noinspection deprecation
<span class="nc" id="L174">            loc = cfg.locale ;</span>
        }
        else
<span class="nc" id="L177">            loc = cfg.getLocales().get(0) ;</span>

<span class="nc" id="L179">        int nLayoutDirection =</span>
<span class="nc" id="L180">                TextUtilsCompat.getLayoutDirectionFromLocale(loc) ;</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        return ( nLayoutDirection != ViewCompat.LAYOUT_DIRECTION_LTR ) ;</span>
    }

	/**
     * (in non-compat context) Determines whether the current text layout is
     * right-to-left.
     * @param ctx the context in which to evaluate text directionality
     * @return {@code true} if text layout is right-to-left
     * @see TextUtils#getLayoutDirectionFromLocale
     * @see &lt;a href=&quot;http://stackoverflow.com/a/14389640&quot;&gt;Stack Overflow answer #14389640&lt;/a&gt;
     * @see &lt;a href=&quot;http://stackoverflow.com/a/23203698&quot;&gt;Stack Overflow answer #23203698&lt;/a&gt;
     * @since zerobandwidth-net/android 0.0.2 (#8)
     */
    public static boolean isTextRTL( Context ctx )
    {
<span class="nc" id="L196">        Configuration cfg = ctx.getResources().getConfiguration() ;</span>

<span class="nc bnc" id="L198" title="All 2 branches missed.">        if( Build.VERSION.SDK_INT &lt; 17 )</span>
<span class="nc" id="L199">            return legacyIsTextRTL(cfg) ;</span>

        Locale loc ;
<span class="nc bnc" id="L202" title="All 2 branches missed.">        if( Build.VERSION.SDK_INT &lt; 24 )</span>
        { // The `locale` property was deprecated in API 24.
            //noinspection deprecation
<span class="nc" id="L205">            loc = cfg.locale ;</span>
        }
        else
<span class="nc" id="L208">            loc = cfg.getLocales().get(0) ;</span>

<span class="nc" id="L210">        int nLayoutDirection = TextUtils.getLayoutDirectionFromLocale(loc) ;</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">        return ( nLayoutDirection != View.LAYOUT_DIRECTION_LTR ) ;</span>
    }

    /**
     * (prior to API 17) Determines whether the current text layout is
     * right-to-left.
     * Consumed by {@link #isTextRTL} and {@link #isTextCompatRTL}.
     * @param cfg the current context's configuration
     * @return {@code true} if text layout is right-to-left
     * @see &lt;a href=&quot;http://stackoverflow.com/a/23203698&quot;&gt;Stack Overflow answer #23203698&lt;/a&gt;
     * @since zerobandwidth-net/android 0.1.5 (#32)
     */
    @SuppressWarnings( &quot;deprecation&quot; ) // locale deprecated only after API 24
    protected static boolean legacyIsTextRTL( Configuration cfg )
    {
<span class="nc" id="L226">        int nDir = Character.getDirectionality(</span>
<span class="nc" id="L227">                cfg.locale.getDisplayName().charAt(0) ) ;</span>
<span class="nc bnc" id="L228" title="All 4 branches missed.">        return( nDir == Character.DIRECTIONALITY_RIGHT_TO_LEFT</span>
             || nDir == Character.DIRECTIONALITY_RIGHT_TO_LEFT_ARABIC ) ;
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span>Generated by the Android Gradle plugin 2.2.0</div></body></html>